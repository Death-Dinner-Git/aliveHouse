#
# The default server
#

server {
    listen       80 default_server;
    server_name  www.haofangzhiye.com m.haofangzhiye.com cms.haofangzhiye.com api.haofangzhiye.com;
    root       /usr/share/nginx/haofangzhiye/public;
    index index.php admin.php phone.php api.php;
    access_log /usr/share/nginx/logs/haofangzhiye.log;

   location / {
        index  index.htm index.html index.php index.shtml admin.php phone.php api.php;
        #nginx核心变量host(老版本是http_host)
        #访问路径的文件不存在则重写URL转交给TP index.php 处理
        if (!-e $request_filename) {
                set $prefix "is";
                set $path_uri "isH";
        }

        #绑定 cms.haofangzhie.com 到 后台
        if ($http_host ~* "cms.haofangzhiye.com") {
                set $path_uri "${prefix}B";
        }
        if ($path_uri = "isB") {
        # 是域名  cms.haofangzhiye.com 且 不是文件
                rewrite  ^/(.*)$  /admin.php/$1  last;
                break;
        }

        #绑定 m.alivehouse.com 到 手机端
        if ($http_host ~* "m.haofangzhie.com") {
                set $path_uri "${prefix}M";
        }
        if ($path_uri = "isM") {
        # 是域名  m.haofangzhiye.com 且 不是文件
                rewrite  ^/(.*)$  /phone.php/$1  last;
                break;
        }

        #绑定 api.haofangzhiye.com 到 接口
        if ($http_host ~* "api.haofangzhiye.com") {
                set $path_uri "${prefix}A";
        }
        if ($path_uri = "isA") {
        # 是域名  api.haofangzhiye.com 且 不是文件
                rewrite  ^/(.*)$  /api.php/$1  last;
                break;
        }

        #访问路径的文件不存在则重写URL转交给TP index.php 处理
        if ($path_uri = "isH") {
                rewrite  ^/(.*)$  /index.php/$1  last;
                break;
        }

    }

   location ~ \.php/?.*$ {
        root        /usr/share/nginx/haofangzhiye/public;
        fastcgi_pass   127.0.0.1:9000;
        fastcgi_index  index.php;
        #加载Nginx默认"服务器环境变量"配置
        include        fastcgi.conf;

        #设置PATH_INFO并改写SCRIPT_FILENAME,SCRIPT_NAME服务器环境变量
        set $fastcgi_script_name2 $fastcgi_script_name;
        if ($fastcgi_script_name ~ "^(.+\.php)(/.+)$") {
            set $fastcgi_script_name2 $1;
            set $path_info $2;
        }
        fastcgi_param   PATH_INFO $path_info;
        fastcgi_param   SCRIPT_FILENAME   $document_root$fastcgi_script_name2;
        fastcgi_param   SCRIPT_NAME   $fastcgi_script_name2;
    }

    # Load configuration files for the default server block.
#       location ~ \.php {
#               root /usr/share/nginx/haofangzhiye/public;
#               fastcgi_pass 127.0.0.1:9000;
#               fastcgi_index index.php admin.php phone.php api.php;
#               fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
#               include fastcgi_params;
#         }


#    error_page 404 /404.html;
#        location = /40x.html {
#    }
#
#    error_page 500 502 503 504 /50x.html;
#        location = /50x.html {
#    }

}



#
# The default server
#

server {
    listen       80 default_server;
    server_name  www.haofangzhiye.com;
    root       /usr/share/nginx/haofangzhiye/public;
    index index.php;
    access_log /usr/share/nginx/logs/haofangzhiye.log;

   location / {
        index  index.htm index.html index.php index.shtml;
        #访问路径的文件不存在则重写URL转交给TP index.php 处理
        if (!-e $request_filename) {
           rewrite  ^/(.*)$  /index.php/$1  last;
           break;
        }
    }

   location ~ \.php/?.*$ {
        root        /usr/share/nginx/haofangzhiye/public;
        fastcgi_pass   127.0.0.1:9000;
        fastcgi_index  index.php;
        #加载Nginx默认"服务器环境变量"配置
        include        fastcgi.conf;

        #设置PATH_INFO并改写SCRIPT_FILENAME,SCRIPT_NAME服务器环境变量
        set $fastcgi_script_name2 $fastcgi_script_name;
        if ($fastcgi_script_name ~ "^(.+\.php)(/.+)$") {
            set $fastcgi_script_name2 $1;
            set $path_info $2;
        }
        fastcgi_param   PATH_INFO $path_info;
        fastcgi_param   SCRIPT_FILENAME   $document_root$fastcgi_script_name2;
        fastcgi_param   SCRIPT_NAME   $fastcgi_script_name2;
    }

    # Load configuration files for the default server block.
#       location ~ \.php {
#               root /usr/share/nginx/haofangzhiye/public;
#               fastcgi_pass 127.0.0.1:9000;
#               fastcgi_index index.php;
#               fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
#               include fastcgi_params;
#         }


#    error_page 404 /404.html;
#        location = /40x.html {
#    }
#
#    error_page 500 502 503 504 /50x.html;
#        location = /50x.html {
#    }

}
